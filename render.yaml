services:
  - type: web
    name: blackcoffe-api
    runtime: docker
    dockerfilePath: ./Dockerfile
    plan: free
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: ConnectionStrings__DefaultConnection
        sync: false
      - key: Jwt__Issuer
        value: BlackCoffe.Api
      - key: Jwt__Audience
        value: BlackCoffe.Clients
      - key: Jwt__SecretKey
        sync: false
      - key: Swagger__Enabled
        value: true
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ASPNETCORE_FORWARDEDHEADERS_ENABLED
        value: true
      - key: Cors__AllowedOrigins__0
        sync: false

  - type: web
    name: blackcoffe-frontend
    runtime: static
    rootDir: frontend
    buildCommand: npm ci && npm run build
    staticPublishPath: dist/frontend/browser
    pullRequestPreviewsEnabled: false
    routes:
      - type: rewrite
        source: /api/v1/*
        destination: https://blackcoffe-api.onrender.com/api/v1/*
      - type: rewrite
        source: /api/*
        destination: https://blackcoffe-api.onrender.com/api/*
      - type: rewrite
        source: /*
        destination: /index.html
